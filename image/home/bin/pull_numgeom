#!/bin/bash

# Usage:
# pull_numgeom [branch] [commit]
# The default branch is master. The default commit is head

NGHOME=$DOCKER_HOME/project/numgeom
mkdir -p $NGHOME

if [ -e "$NGHOME/.git" ]
then
    echo "NumGeom was already cloned. Pulling from repository"

    cd $NGHOME
    git pull
else
    BRANCH=${1:-master}
    # Remove octave-workspace if it exists
    rm -f $NGHOME/octave-workspace

    git clone --depth 10 --no-single-branch --branch $BRANCH git@bitbucket.org:numgeom/numgeom.git $NGHOME
fi

cd $NGHOME
if [[ -n "$2" && "$(git log --pretty=oneline --abbrev-commit --abbrev=7 -n 1)" != "$1"* ]]
then
    git checkout $2
fi
